[[T3-Arquitectura_1-CA.pdf]]

Sistema informàtic: hardware + software

# Arquitectura de computadors
Regles que segueixen els components hardware i software tal que un computador funcioni el més òptim possible
## Arquitectura Von-Neumann
1. Memòria: dona informació al Control Unit
2. Control Unit: decodifica la informació i envia el càlcul a fer al Logic Unit
3. Logic Unit: executa el càlcul i el retorna a la Memòria

## Arquitectura Harvard
2 estructures
- Instruccions
- Memòria

# Arquitectura del processador
- Unitat de control d'instruccions: controla les instruccions executades i el flux d'informació
- Register file: Unitat més ràpida i petita (32 or 64 Bytes), s'hi guarden operands i instruccions operades i per operar
- Memòria Cache: unitat més gran que el register file, pero no tan ràpida
- Interfície de Bus: comunica la CPU amb la memòria exterior
- Arithmetic/Logic Unit (ALU): operacions senzilles
- Altres: Unitats complexes, acceleradors

# Execució d'instruccions
1. Fetch: busca la següent instrucció en el Program Counter, el qual dona la posició de memòria de la pròxima instrucció
2. Decodificació: Per entendre els bits que indiquen les instruccions 
3. Execute: es realitza la instrucció
4. Memory: es guarda el resultat
5. Write Back: Estableix una pauta al guardar diferents resultats de diferents instruccions

# Fils d'instruccions (Thread)
En una operació com `i++` s'executen varies operacions: buscar en la memòria, carregar el valor, cambiar, guardar...

## hardware thread vs software threat
Software: conjunt d'instruccions que s'executen un rere l'altre (AKA el codi a ser executat)
Un software threat es mapeja amb un hardware threat (de les instruccions a les execucions)

# Concurrència a nivell de threat
## Nivells de compartició de recursos
- Multi-processador: Diverses CPU's
- Multi-core: la CPU té tots els components del core replicats, comparteixen una Cache, que conecta amb la memòria
- Multi-thread: diversos fils dins del core que comparteixen una cache

# Instruction Set Architecture (ISA)
Defineix la complexitat del processador
Conjunt de instruccions que ens permeten especificar el format de les instruccions, el codificat de les operacions, la manera d'accedir la memòria, etc

- Complex instruction set computing (CISC): La càrrega d'operacions complexes cau sobre el hardware (el compilador no ha de traduir operacions complexes)
- Reduced instruction set computing (RISC): La càrrega d'operacions complexes cau sobre el compilador (ha de traduir de operacions complexes a unes quantes de senzilles)

Codi ensamblador: llenguatge més o menys entendible pel programador

# Banc de registres
De tota la jerarquia de memories, és la més petita i la més ràpida
Dins del processador. 

# Arithmetic and Logic Unir (ALU)
Operacions senzilles aritmetico-lògiques

# Paral·lelisme SIMD
Single/Multiple Instruction Single/Multiple Data:
`a: list[T], b: list[T]`
 - Single+Single: `c[i] = a[i]+b[i]`
 - Single+Multiple:`c=a+b
 - Multiple+Single:
 - Multiple+Multiple:

# Organització del Hardware
## Bus i Entrada/Sortida
- Direct Memory Access: Permet que l'accés de memòria i exterior no hagi de ser controlat pel processador
## Acceleradors

## GPU: Graphical Processing Unit
Molt utilitzat per IA
Conté milers de threats: alta capacitat de computació
Necessita molta memòria

## Xarxa
Enviar/rebre informació a servidors/networks

## Perifèrics HMI
Teclats, ratolins, discos...

### Discos
- Disc vs Memòria: La memòria perd el seu contingut quan perd la corrent elèctrica. Els discos no són volàtils

- Guardar valors als discos (Sector): Definit per hardware amb mida fixa (normalment 512 Bytes), similar a un byte, no es pot guardar menys
- Organització de storage (Bloc): Definit per software. Nombre consecutiu de sectors que s'envien a la memòria del computador
- Fragmentació: pèrdua d'espai d'emmagatzematge causat per una mida incoherent del bloc
- Localitat: Característica que ens permet optimitzar la crida de dades a curt termini
	Exemple: al llegir l'element 0 d'un vector, probablement es llegeixi l'element 1 a continuació, per tant es pot aprofitar la localitat del vector

# Màquina virtual
Software que virtualitza tot l'entorn d'un ordinador. En essència, fer creure al ordinador que  existeixen unes certes característiques de hardware (existeixin o no)

## Jerarquia de memòria
Baix: Memòria més gran, més lent d'accedir
Alt: Memòria més petita, més ràpid d'accedir

1. Register file: inputs i outputs de la ALU
2. SRAM (AKA Cache): Diversos subnivells. Al fer una operació, es va buscant a cada nivell de dalt a baix per la informació necessària
3. Memoria principal (RAM)
4. Discos locals
5. Distributed file systems: Google drive, GitHub...

## Localitat
### Temporal
Al demanar una dada, s'espera que es torni a accedir en poc temps

### Espacial
Al demanar una dada d'un array, s'espera que es torni a accedir als elements que es troben a prop

## Accés al cache
### Estructura
S'utilitzen 32 bits per representar la posició , de dreta a esquerra:
- Block offset: $n$ bits quan hi han $2^{n}$ blocks en una fila, marca la columna
- Set index: $n$ bits quan hi han $2^{n}$ sets en una columna, marca la fila
- La resta: etiqueta, per diferenciar entre una referència al nivell de cache actual i la d'un altre nivell (cada fila té la seva)
En una memòria cache hi ha un array de conjunts (que pot tenir una o més línies)
- Columnes: sets
- Files: blocks

Pot haver-hi conflicte en un set (dos variables apunten a la mateixa posició)
- Solució: afegir més files a un set (genera associativitat)
- Problemes: més comparacions i decisions 

## Estratègies d'escriptura
Encert: s'ha trobat l'etiqueta de la variable en el nivell actual de cache
- Write-through: quan s'escriu a un nivell s'escriu a nivells inferiors
	Més actualitzat a canvi d'un augment del tràfic d'informació, que implica consum major d'energia
- Write-back: Quan surti de la cache (més tard de quan s'escriu, quan l'han de fer fora), s'actualitza a nivells inferiors
	No sincronitzat del tot entre capes, però no gasta massa energia
- Write-buffer: millora el rendiment del write-through

Errada: no s'ha trobat l'etiqueta i per tant s'ha de passar al següent nivell
- Write-no-allocate: quan es troba, passa dels nivells superiors i arriba directament al core
- Write-allocate: quan es troba, transfereix la data de nivell a nivell

Consistència i coherència: 
Quan múltiples cores operen alhora amb la mateixa variable poden haver-hi incoherència
- Bit de validesa: mostra si la data encara és vàlida (és a dir, que no s'ha actualitzat en altres nivells de cache)

## Errada de Cache
Tipus:
- Cold: la primera vegada que s'executa un programa, no hi ha res preparat i pot arribar a fallar
- Conflict miss: dos posicions diferentes de memòria que coincideixen en el mateix set poden acabar en conflicte pels blocks
- Capacity miss: no hi cap en el cache

